From 7c682350741823d91dc8b7840bef57e9fa5b05f5 Mon Sep 17 00:00:00 2001
From: Stefano Zilli <stefano.zilli@cern.ch>
Date: Thu, 17 Jul 2014 10:14:15 +0200
Subject: [PATCH] Patches to allow icehouse ceilometer to run with havana nova

Change-Id: Iaa4fc29b6ad1c53564a5610300895db31d2ce7fd
---
 ceilometer/compute/nova_notifier.py          |    2 ++
 ceilometer/compute/virt/libvirt/inspector.py |    5 ++++-
 2 files changed, 6 insertions(+), 1 deletions(-)

diff --git a/ceilometer/compute/nova_notifier.py b/ceilometer/compute/nova_notifier.py
index 58e500e..10a4f76 100644
--- a/ceilometer/compute/nova_notifier.py
+++ b/ceilometer/compute/nova_notifier.py
@@ -55,6 +55,8 @@ class DeletedInstanceStatsGatherer(object):
 
     def __call__(self, instance):
         cache = {}
+        if not isinstance(instance,list):
+            instance = [instance]
         samples = self.mgr.map_method('get_samples',
                                       self,
                                       cache,
diff --git a/ceilometer/compute/virt/libvirt/inspector.py b/ceilometer/compute/virt/libvirt/inspector.py
index 16fb6bf..20d2d75 100644
--- a/ceilometer/compute/virt/libvirt/inspector.py
+++ b/ceilometer/compute/virt/libvirt/inspector.py
@@ -40,8 +40,11 @@ libvirt_opts = [
 ]
 
 CONF = cfg.CONF
-CONF.register_opts(libvirt_opts)
 
+try:
+  CONF.register_opts(libvirt_opts)
+except cfg.DuplicateOptError:
+  pass
 
 class LibvirtInspector(virt_inspector.Inspector):
 
-- 
1.7.1

